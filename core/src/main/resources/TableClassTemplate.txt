@args String packageName
package @packageName;

import java.util.*;
import java.math.*;
import org.nutz.dao.entity.annotation.*;

@args com.asiainfo.dbb.model.Table table

@def boolean isSinglePKColumn(String columnName) {
    boolean isSinglePK = table.getPrimaryKey() != null && table.getPrimaryKey().getColumns().size() == 1;
    if(isSinglePK) {
        return table.getPrimaryKey().getColumns().get(0).equals(columnName);
    }
    return false;
}

@def renderPKAnnotation() {
    @if(table.getPrimaryKey() != null && table.getPrimaryKey().getColumns().size() > 1){
        @@PK({@table.getPrimaryKey().getColumns().app_format().app_upperWord()})
    }
}

@def renderIndexesAnnotation() {
    @if(!table.getIndexes().isEmpty()) {
        @@TableIndexes({
        @for(com.asiainfo.dbb.model.Index index : table.getIndexes()) {
           @@Index(name = "@index.getName()",
                   fields = {@index.getColumns().app_format().app_upperWord()},
                   unique = @index.getType().name().equals("UNIQUE")) @if(!index_isLast) { , }
        }
        })
    }
}

@def renderMethodName(String columnName){
@columnName.toLowerCase().app_upperWord().app_upperFirst()
}

@@Table("@table.getName()")
@@Comment("@table.getComment()")
@renderPKAnnotation()
@renderIndexesAnnotation()
public class @table.getName().toLowerCase().app_upperWord().app_upperFirst() {

@for(com.asiainfo.dbb.model.Column column : table.getColumns()) {
    @{String columnName = column.getName()}
    @if(isSinglePKColumn(columnName)) {
        @{columnName = "id"}
        @if(column.getJavaType().getSimpleName().equals("String")) {@@Name} else {@@Id}
    }
    @@Column("@column.getName()")
    @@ColDefine(
        type = ColType.@column.getType()
        @if(column.getWidth() != null) {,width = @column.getWidth()}
        @if(column.getPrecision() != null) {,precision = @column.getPrecision()}
        ,notNull = @if(column.getNullable()) {false} else {true}
    )
    @@Comment("@column.getComment()")
    private @column.getJavaType().getSimpleName() @columnName.toLowerCase().app_upperWord();

}

@for(com.asiainfo.dbb.model.Column column : table.getColumns()) {
    @{ String columnName = column.getName() }
    @if(isSinglePKColumn(columnName)) {
        @{columnName = "id"}
    }
    public @column.getJavaType().getSimpleName() get@renderMethodName(columnName) () {
        return @columnName.toLowerCase().app_upperWord();
    }
    public void set@renderMethodName(columnName) (@column.getJavaType().getSimpleName() obj) {
        @columnName.toLowerCase().app_upperWord() = obj;
    }

}
}